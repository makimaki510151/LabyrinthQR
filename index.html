<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2P迷路レースゲーム - オンライン</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="select-screen" class="screen active">
        <div class="title-container">
            <h1>2P迷路レース - 接続選択</h1>
            <button id="select-pc-button" class="menu-button">PCでゲーム画面を表示</button>
            <button id="select-controller-button" class="menu-button">スマホでコントローラーを使用</button>
        </div>
    </div>

    <div id="pc-title-screen" class="screen">
        <div class="title-container">
            <h1>2P迷路レース (ホスト画面)</h1>
            
            <p id="pc-connection-status" class="connection-status-info">サーバー接続中...</p>

            <div id="room-info-area" style="display: none;">
                <h2>ルームID: <span id="room-id" class="room-id-display">--</span></h2>
                <div id="qrcode-container">
                    <p>コントローラー接続用QRコード:</p>
                    <div id="qrcode" style="margin: 20px auto; width: 200px; height: 200px;"></div>
                    <p id="qr-status" style="font-size: 0.9rem; margin-top: 10px;">スマホでスキャンしてください。</p>
                </div>
                
                <div class="controller-status-group">
                    <span id="p1-connect-status" class="status-indicator waiting">P1: 待機中</span>
                    <span id="p2-connect-status" class="status-indicator waiting">P2: 待機中</span>
                </div>

                <button id="start-button" class="menu-button" disabled>ゲーム開始 (P1/P2接続後)</button>
            </div>
            
            <button id="pc-back-to-select" class="menu-button small">選択画面に戻る</button>
        </div>
    </div>
    
    <div id="controller-entry-screen" class="screen">
        <div class="title-container">
            <h1>コントローラー接続</h1>
            <p>PC画面に表示されたルームIDを入力してください。</p>
            <input type="text" id="room-id-input" placeholder="例: ABCD" maxlength="4" class="room-id-input">
            <button id="connect-room-button" class="menu-button">ルームに接続</button>
            <p id="entry-status-message" class="connection-status-info"></p>
            <button id="entry-back-to-select" class="menu-button small">選択画面に戻る</button>
        </div>
    </div>
    
    <div id="game-screen" class="screen">
        <div class="game-container">
            <div class="game-header">
                <button id="back-to-title" class="menu-button small">タイトルに戻る</button>
                <span id="current-level">45x45 対戦レース</span>
            </div>
            
            <div class="game-main-tri-view">
                
                <div class="player-view-container p1-view">
                    <h3>PLAYER 1 (5x5 View)</h3>
                    <canvas id="p1-canvas" class="player-canvas" width="450" height="450"></canvas>
                </div>

                <div class="center-panel">
                    <h3>全体マップ</h3>
                    <div class="maze-container">
                        <canvas id="minimap-canvas" width="450" height="450"></canvas> 
                    </div>

                    <div class="game-sidebar">
                        <div id="status-p1" class="player-status p1">
                            <h2>PLAYER 1</h2>
                            <p>ステータス: 走行中</p>
                        </div>

                        <div id="status-p2" class="player-status p2">
                            <h2>PLAYER 2</h2>
                            <p>ステータス: 走行中</p>
                        </div>

                        <div class="gamepad-info">
                            <h3>接続情報</h3>
                            <p id="gamepad-status">サーバーと通信中...</p>
                        </div>
                    </div>
                </div>

                <div class="player-view-container p2-view">
                    <h3>PLAYER 2 (5x5 View)</h3>
                    <canvas id="p2-canvas" class="player-canvas" width="450" height="450"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div id="controller-screen" class="screen">
        <div class="controller-container">
            <h1 id="controller-player-title">プレイヤー未割り当て</h1>
            <p id="controller-game-status">ゲーム開始を待っています...</p>
            <div class="dpad">
                <button class="dpad-button up" data-dir="0,-1">▲</button>
                <button class="dpad-button left" data-dir="-1,0">◀</button>
                <button class="dpad-button center" disabled>OK</button>
                <button class="dpad-button right" data-dir="1,0">▶</button>
                <button class="dpad-button down" data-dir="0,1">▼</button>
            </div>
            <p id="controller-connection-status" class="connection-status-info">サーバー接続中...</p>
            <button id="controller-back-to-select" class="menu-button small">選択画面に戻る</button>
        </div>
    </div>


    <div id="clear-screen" class="screen">
        <div class="clear-container">
            <h2 id="winner-title">勝者決定！</h2>
            <p id="clear-message">PLAYER X の勝利！</p>
            <button id="back-to-select-clear" class="menu-button">タイトルに戻る</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>